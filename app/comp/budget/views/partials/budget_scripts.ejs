<!-- <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script> -->
<script>
    $(document).ready(function () {
        console.log('budget_scripts.ejs');
        var donut1 = undefined;
        var donut2 = undefined;
        var donut3 = undefined;
        var ValRoutine = 0;
        var ValPeriodic = 0;
        var ValEmergency = 0;
        var ValAmount = 0;
        var ValBrushcutting = 0;
        var ValDrainclearing = 0;
        var ValPatching = 0;
        var ValRoadSafetyImprovement = 0;
        var ValDesignProjects = 0;
        var ValWorkInterventions = 0;
        var ValInspections = 0;

        var risk_rating = [];
        risk_rating['0-20'] = [];
        risk_rating['0-20']['A'] = 1;
        risk_rating['0-20']['B'] = 1;
        risk_rating['0-20']['C'] = 2;
        risk_rating['0-20']['D'] = 2;
        risk_rating['0-20']['E'] = 3;
        risk_rating['20-40'] = [];
        risk_rating['20-40']['A'] = 1;
        risk_rating['20-40']['B'] = 2;
        risk_rating['20-40']['C'] = 2;
        risk_rating['20-40']['D'] = 3;
        risk_rating['20-40']['E'] = 3;
        risk_rating['40-60'] = [];
        risk_rating['40-60']['A'] = 2;
        risk_rating['40-60']['B'] = 3;
        risk_rating['40-60']['C'] = 3;
        risk_rating['40-60']['D'] = 3;
        risk_rating['40-60']['E'] = 4;
        risk_rating['60-80'] = [];
        risk_rating['60-80']['A'] = 2;
        risk_rating['60-80']['B'] = 3;
        risk_rating['60-80']['C'] = 3;
        risk_rating['60-80']['D'] = 4;
        risk_rating['60-80']['E'] = 5;
        risk_rating['80-100'] = [];
        risk_rating['80-100']['A'] = 3;
        risk_rating['80-100']['B'] = 3;
        risk_rating['80-100']['C'] = 4;
        risk_rating['80-100']['D'] = 5;
        risk_rating['80-100']['E'] = 5;
        console.log(risk_rating);

        var ddata1 = [{
                label: "Routine",
                value: 25
            },
            {
                label: "Periodic",
                value: 70
            },
            {
                label: "Emergency",
                value: 5
            }
        ];
        var ddata2 = [{
                label: "Brush cutting",
                value: 45
            },
            {
                label: "Drain clearing",
                value: 20
            },
            {
                label: "Patching",
                value: 20
            },
            {
                label: "Road Safety Improvement",
                value: 15
            }
        ];
        var ddata3 = [
            // {
            //     label: "Design Projects",
            //     value: 15
            // },
            {
                label: "Work Interventions",
                value: 75
            },
            {
                label: "Inspections",
                value: 10
            }
        ];

        function sanitizeNumberFields(field) {
            var max = parseInt(field.attr('max'));
            var min = parseInt(field.attr('min'));
            if (field.val() > max) {
                field.val(max);
            } else if (field.val() < min) {
                field.val(min);
            }
        };

        function paintDonutChart1() {

            if ($('#Routine').val().length > 0) {
                ddata1[0].value = ValRoutine * ValAmount / 100;
            } else {
                ddata1[0].value = 0;
                // ddata1[0].value = 25 * ValAmount / 100;

            }
            if ($('#Periodic').val().length > 0) {
                ddata1[1].value = ValPeriodic * ValAmount / 100;
            } else {
                ddata1[1].value = 0;
                // ddata1[1].value = 70 * ValAmount / 100;

            }
            if ($('#Emergency').val().length > 0) {
                ddata1[2].value = ValEmergency * ValAmount / 100;
            } else {
                ddata1[2].value = 0;
                // ddata1[2].value = 5 * ValAmount / 100;

            }

            if (donut1 === undefined) {

                donut1 = Morris.Donut({
                    // ID of the element in which to draw the chart.
                    element: 'donut1',
                    // Chart data records -- each entry in this array corresponds to a point on
                    // the chart.
                    data: ddata1
                });
            } else {
                donut1.setData(ddata1);
            }

        }

        function paintDonutChart2() {
            var total = ValRoutine * ValAmount / 100

            if ($('#Brushcutting').val().length > 0) {
                ddata2[0].value = ValBrushcutting * total / 100;
            } else {
                ddata2[0].value = 0;
                // ddata2[0].value = 25 * total / 100;

            }
            if ($('#Drainclearing').val().length > 0) {
                ddata2[1].value = ValDrainclearing * total / 100;
            } else {
                ddata2[1].value = 0;
                // ddata2[1].value = 70 * total / 100;

            }
            if ($('#Patching').val().length > 0) {
                ddata2[2].value = ValPatching * total / 100;
            } else {
                // ddata2[2].value = 5 * total / 100;
                ddata2[2].value = 0;

            }
            if ($('#RoadSafetyImprovement').val().length > 0) {
                ddata2[3].value = ValRoadSafetyImprovement * total / 100;
            } else {
                ddata2[3].value = 0;
                // ddata2[3].value = 5 * total / 100;

            }

            if (donut2 === undefined) {

                donut2 = Morris.Donut({
                    // ID of the element in which to draw the chart.
                    element: 'donut2',
                    // Chart data records -- each entry in this array corresponds to a point on
                    // the chart.
                    data: ddata2,
                    colors: ['#ffee00', '#c1b501', '#ffb600', '#bc8701']
                });
            } else {
                donut2.setData(ddata2);
            }

        }

        function paintDonutChart3() {
            var total = ValPeriodic * ValAmount / 100

            // if ($('#Brushcutting').val().length > 0) {
            //     ddata3[0].value = ValDesignProjects * total / 100;
            // } else {
            //     ddata3[0].value = 0;
            //     // ddata3[0].value = 15 * total / 100;

            // }
            if ($('#Brushcutting').val().length > 0) {
                ddata3[0].value = ValWorkInterventions * total / 100;
            } else {
                ddata3[0].value = 0;
                // ddata3[0].value = 75 * total / 100;

            }
            if ($('#Drainclearing').val().length > 0) {
                ddata3[1].value = ValInspections * total / 100;
            } else {
                ddata3[1].value = 0;
                // ddata3[1].value = 10 * total / 100;

            }


            if (donut3 === undefined) {

                donut3 = Morris.Donut({
                    // ID of the element in which to draw the chart.
                    element: 'donut3',
                    // Chart data records -- each entry in this array corresponds to a point on
                    // the chart.
                    data: ddata3,
                    colors: ['#ff0000', '#d6021e']
                });
            } else {
                donut3.setData(ddata3);
            }

        }

        $('#Summary').click(function () {
            //alert('Summary');
            $('#SummaryContent').toggle('blind', {}, 500);

        });
        $('input[type=radio][name=optionsRadios]').change(function () {
            switch ($(this).val()) {
                case "Annualavailablebudget":
                    $('#amountdiv').show();
                    $('#menu_annual').show();
                    $('#content_annual').show();
                    $('#menu_global').hide();
                    $('#content_global').hide();

                    break;
                case "Globalbudget":
                    $('#amountdiv').hide();
                    $('#menu_annual').hide();
                    $('#content_annual').hide();
                    $('#menu_global').show();
                    $('#content_global').show();

                    break;

                default:
                    break;
            }
        });
        $('input[type=radio][name=riskoptionsRadios]').change(function () {
            switch ($(this).val()) {
                case "NaturalHazards":
                    $('#naturalHazardsContent').show();
                    $('#PhysicalDeteriorationContent').hide();
                    $('#graphButton').prop("disabled", false);
                    break;
                case "PhysicalDeterioration":
                    $('#PhysicalDeteriorationContent').show();
                    $('#naturalHazardsContent').hide();
                    $('#graphButton').prop("disabled", false);
                    break;

                default:
                    break;
            }
        });
        // $('#Annualavailablebudget').click(function () {
        //     $('#amountdiv').toggle('blind', {}, 500);
        //     $('#menu_annual').toggle('blind', {}, 500);
        //     $('#content_annual').toggle('blind', {}, 500);
        // });

        $('#amountdiv').change(function (event) {
            $('#InvestmentFY2018').val('EC$ ' + $('#amount').val());
            ValAmount = $('#amount').val();
            paintDonutChart1();
        });

        $('#Routine').change(function (event) {
            sanitizeNumberFields($(this));
            ValRoutine = $('#Routine').val();
            $('#disabledInputRoutine').val('EC$ ' + ValAmount * ValRoutine / 100);
            $('#Brushcutting').trigger('change');
            $('#Drainclearing').trigger('change');
            $('#Patching').trigger('change');
            $('#RoadSafetyImprovement').trigger('change');
            paintDonutChart1();
            paintDonutChart2();
        });
        $('#Periodic').change(function (event) {
            sanitizeNumberFields($(this));
            ValPeriodic = $('#Periodic').val();
            $('#disabledInputPeriodic').val('EC$ ' + ValAmount * ValPeriodic / 100);
            //$('#DesignProjects').trigger('change');
            $('#WorkInterventions').trigger('change');
            $('#Inspections').trigger('change');
            paintDonutChart1();
            paintDonutChart3();
        });
        $('#Emergency').change(function (event) {
            sanitizeNumberFields($(this));
            ValEmergency = $('#Emergency').val();
            $('#disabledInputEmergency').val('EC$ ' + ValAmount * ValEmergency / 100);
            paintDonutChart1();
        });


        $('#Brushcutting').change(function (event) {
            sanitizeNumberFields($(this));
            ValBrushcutting = $('#Brushcutting').val();
            $('#disabledInputBrushcutting').val('EC$ ' + ValAmount * ValRoutine * ValBrushcutting /
                10000);
            paintDonutChart2();
        });
        $('#Drainclearing').change(function (event) {
            sanitizeNumberFields($(this));
            ValDrainclearing = $('#Drainclearing').val();
            $('#disabledInputDrainclearing').val('EC$ ' + ValAmount * ValRoutine * ValDrainclearing /
                10000);
            paintDonutChart2();
        });
        $('#Patching').change(function (event) {
            sanitizeNumberFields($(this));
            ValPatching = $('#Patching').val();
            $('#disabledInputPatching').val('EC$ ' + ValAmount * ValRoutine * ValPatching / 10000);
            paintDonutChart2();
        });
        $('#RoadSafetyImprovement').change(function (event) {
            sanitizeNumberFields($(this));
            ValRoadSafetyImprovement = $('#RoadSafetyImprovement').val();
            $('#disabledInputRoadSafetyImprovement').val('EC$ ' + ValAmount * ValRoutine *
                ValRoadSafetyImprovement / 10000);
            paintDonutChart2();
        });



        $('#DesignProjects').change(function (event) {
            sanitizeNumberFields($(this));
            ValDesignProjects = $('#DesignProjects').val();
            $('#disabledInputDesignProjects').val('EC$ ' + ValAmount * ValPeriodic * ValDesignProjects /
                10000);
            paintDonutChart3();
        });
        $('#WorkInterventions').change(function (event) {
            sanitizeNumberFields($(this));
            ValWorkInterventions = $('#WorkInterventions').val();
            $('#disabledInputWorkInterventions').val('EC$ ' + ValAmount * ValPeriodic *
                ValWorkInterventions /
                10000);
            paintDonutChart3();
        });
        $('#Inspections').change(function (event) {
            sanitizeNumberFields($(this));
            ValInspections = $('#Inspections').val();
            $('#disabledInputInspections').val('EC$ ' + ValAmount * ValPeriodic * ValInspections /
                10000);
            paintDonutChart3();
        });

        $('#levelRisk').change(function (event) {
            console.log($(this).val());
            // var riskrange = $(this).val();
            // var riskfilter = [];
            // for (var row of Object.keys(risk_rating)) {
            //     for (var col of Object.keys(risk_rating[row])) {
            //         console.log(row + ': ' + col + ' --> ' + risk_rating[row][col]);
            //         if (risk_rating[row][col] === riskrange * 1) {
            //             riskfilter.push(row + '__' + col);
            //         }
            //     }
            // }
            // console.log(riskfilter);
            var dataPost = {};
            dataPost[this.name] = $(this).val();
            var p1 = $.ajax({
                url: '/auth/WEB/budget/indexes/' + $(this).val(),
                data: JSON.stringify(dataPost),
                type: 'POST',
                contentType: 'application/json'
            }, function (data) {
                // console.log('koboinfo ' + JSON.stringify(data));
                return (data);
            });
            Promise.all([p1]).then(function (values) {

                //$("html").html(values[0]);
                if (values[0].result === "OK") {
                    console.log('OK');
                    for (var val of Object.keys(values[0])) {
                        console.log(val + ' ' + values[0][val]);
                        if (val.indexOf('investment') >= 0)
                            $('#' + val).html(Math.round(values[0][val] * 100 / 1000000) / 100);
                        else if (val.indexOf('km') >= 0)
                            $('#' + val).html(Math.round(values[0][val] * 100 / 1000) / 100);
                        else
                            $('#' + val).html(values[0][val]);
                    }

                } else {
                    console.log('ERROR');
                }
            });


        });



    });
</script>