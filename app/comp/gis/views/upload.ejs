<!DOCTYPE html>
<html>

<head>
    <% include partials/head %>
</head>

<body>

    <section id="container">
        <!-- **********************************************************************************************************************************************************
      TOP BAR CONTENT & NOTIFICATIONS
      *********************************************************************************************************************************************************** -->
        <!--header start-->
        <header class="header black-bg">
            <% include partials/header %>
        </header>
        <!--header end-->

        <!-- **********************************************************************************************************************************************************
      MAIN SIDEBAR MENU
      *********************************************************************************************************************************************************** -->
        <!--sidebar start-->
        <aside>
            <% include partials/left_menu %>
        </aside>
        <!--sidebar end-->

        <!-- **********************************************************************************************************************************************************
      MAIN CONTENT
      *********************************************************************************************************************************************************** -->
        <!-- main content Permission denied -->
        <% if(!token.admin) {%>
            <% include partials/error_permissions %>
                <!-- End permission denied -->
                <%} else {%>
                    <!--main content start-->
                    <section id="main-content">
                        <section class="wrapper">
                            <h3><i class="fa fa-angle-right"></i> Carga de Ficheros</h3>
                            <div class="row mt">
                                <div class="col-md-12">
                                    <div class="form-panel">

                                        <form class="form-horizontal style-form" enctype="multipart/form-data" method="post" action="/auth/WEB/gis/upload">
                                            <div class="form-group">
                                                <label class="col-sm-2 col-sm-2 control-label">Type file</label>
                                                <div class="col-sm-2">
                                                    <select class="form-control" name="type">
                                                            <option>GeoJson</option>
                                                            <option>CSV</option>
                                                            <!-- <option>3</option>
                                                                <option>4</option>
                                                                <option>5</option> -->
                                                          </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <div class="col-sm-10">
                                                    <input type="file" name="file" class="alert alert-info">
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <div class="col-sm-10">
                                                    <!-- <input type="submit" value="Upload"> -->
                                                    <button type="submit" class="btn btn-success" value="Upload"><i class="fa fa-check"></i> Upload</button>
                                                    <button type="button" class="btn btn-danger" data-dismiss="modal">Cancelar</button>

                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <!-- /content-panel -->
                                </div>
                                <!-- /col-md-12 -->
                            </div>
                            <!-- /row -->
                            <div class="row mt">
                                <div class="col-md-12">
                                    <div class="content-panel">
                                        <h4><i class="fa fa-angle-right"></i> Listado de Ficheros</h4>
                                        <table class="table table-striped table-advance table-hover">
                                            <thead>
                                                <tr>
                                                    <th><i class="fa fa-file"></i> Original name</th>
                                                    <th><i class="fa fa-list-alt"></i> Type</th>
                                                    <th><i class="fa fa-code"></i> Mimetype</th>
                                                    <th><i class="fa fa-hdd-o"></i> Size</th>
                                                    <th><i class="fa fa-user-circle"></i> Usuario prop</th>
                                                    <th><i class=" fa fa-calendar"></i> Fecha</th>
                                                    <th><i class=" fa fa-edit"></i> Acciones</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <% for(var i=0; i < fup.length; i++) {%>
                                                    <tr>
                                                        <td>
                                                            <%= fup[i].originalname %>
                                                        </td>
                                                        <td>
                                                            <%= fup[i].type %>
                                                        </td>
                                                        <td>
                                                            <%= fup[i].mimetype %>
                                                        </td>
                                                        <td>
                                                            <%= (fup[i].size/(1024)).toFixed(2) %> Kb
                                                        </td>
                                                        <td>
                                                            <%= fup[i].owner %>
                                                        </td>
                                                        <td>
                                                            <%= moment(fup[i].created_at).format( 'DD-MM-YYYY HH:mm:ss') %>
                                                        </td>
                                                        <td>
                                                            <div id="button_<%= fup[i]._id %>">
                                                                <% if( "pending" == fup[i].status ) {   %>
                                                                    <button onclick="validate('<%= fup[i]._id %>');" class="btn btn-warning btn-xs">
                                                                        <i class="fa fa-question-circle"> Sin validar</i> 
                                                                    </button>
                                                                    <% } else if( "validate" == fup[i].status ) { %>
                                                                        <button class="btn btn-success btn-xs">
                                                                            <i class="fa fa-check"> Valido</i> 
                                                                        </button>
                                                                        <% } else if( "error" == fup[i].status ) { %>
                                                                            <button class="btn btn-danger btn-xs">
                                                                                <i class="fa fa-exclamation-triangle"> Error</i> 
                                                                            </button>
                                                                            <% } %>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <% } %>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </section>
                    <!-- /MAIN CONTENT -->
                    <% } %>
                        <!-- MODAL SECTION -->
                        <!-- +++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
                        <!-- Modal -->


                        <!-- +++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
                        <!-- /MODAL SECTION -->

                        <!--main content end-->
                        <!--footer start-->
                        <footer class="site-footer">
                            <% include partials/footer %>

                        </footer>
                        <!--footer end-->
    </section>

    <!-- js placed at the end of the document so the pages load faster -->
    <% include partials/footer_scripts %>

        <!--script for this page-->
        <script>
            function validate(id) {
                // alert("VALIDATE " + id);
                $.post('/auth/WEB/gis/validate/' + id, function(returnedData) {
                    //console.log(returnedData);
                    // $("#tag_" + id).load(location.href + " #tag_" + id); // Add space between URL and selector.
                    $("#button_" + id).load(location.href + " #button_" + id); // Add space between URL and selector.

                });

            };
        </script>


</body>

</html>