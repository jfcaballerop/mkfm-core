<script>
    var ifdtobject;
    var nchar = 0;
    var resized = false;

    $(document).ready(function() {

        $('#generaldata').click(function() {
            var $this = $(this);
            $('#divmap1').show();
            if ($this.prop('checked')) {
                nchar = $this.val().length;
                $('#divmap1').prepend(gen_data.join(''));
                if (ifdtobject.properties.asset_type === 'ROAD') {
                    console.log(ifdtobject);
                    $.each(ROADS, function(key, value) {
                        if (Array.isArray(ifdtobject.properties[key])) {
                            console.log('Is Array');
                            if (ifdtobject.properties[key][0] != undefined && ifdtobject.properties[key][0] != "") {
                                $('#generaldatatbody').append('<tr><td>' + value + '</td><td>' + ifdtobject.properties[key][0] + '</td></tr>');

                            } else {
                                $('#generaldatatbody').append('<tr><td>' + value + '</td><td>' + '--' + '</td></tr>');

                            }
                        } else {
                            console.log('Is NOT Array');
                            if (ifdtobject.properties[key] != undefined) {
                                $('#generaldatatbody').append('<tr><td>' + value + '</td><td>' + ifdtobject.properties[key] + '</td></tr>');

                            } else {
                                $('#generaldatatbody').append('<tr><td>' + value + '</td><td>' + '--' + '</td></tr>');

                            }
                        }


                    });

                }
                $('#generaldatadiv').show();

            } else {
                $('#generaldatadiv').hide();

            }
        });
        $('#inventorydata').click(function() {
            var $this = $(this);
            $('#divmap1').show();
            if ($this.prop('checked')) {
                nchar = $this.val().length;
                $('#divmap1').append(inv_data.join(''));
                $('#inventorydatadiv').show();

            } else {
                $('#inventorydatadiv').hide();

            }
        });
        $('#operation').click(function() {
            var $this = $(this);
            $('#divmap1').show();
            if ($this.prop('checked')) {
                nchar = $this.val().length;
                $('#divmap1').append(op_data.join(''));
                $('#operationdiv').show();

            } else {
                $('#operationdiv').hide();

            }
        });
        $('#risk').click(function() {
            var $this = $(this);
            $('#divmap1').show();
            if ($this.prop('checked')) {
                nchar = $this.val().length;
                $('#divmap1').append(risk_data.join(''));
                $('#riskdiv').show();

            } else {
                $('#riskdiv').hide();

            }
        });
        $("#searchtool").on('keyup', function(e) {
            var $this = $(this);

            if (e.keyCode == 13) {
                // Do something
                // alert('Buscando ...' + $this.val().length);
                $('#error').hide();
                $('#error').empty();
                $('#response').hide();
                $('#response').empty();
                $("#datainfophoto").empty();
                $("#datainfophoto").hide();
                var dataPost = {};

                if ($this.val().length <= 0) {
                    $('#error').hide();
                    $('#error').empty();
                    $('#error').append("Empty value.<br>Try again.");
                    $('#error').show();

                } else {


                    var p1 = $.ajax({
                        url: '/auth/WEB/infodatatrack/list_ifdt/' + $this.val(),
                        data: JSON.stringify(dataPost),
                        type: 'POST',
                        contentType: 'application/json'
                    }, function(data) {
                        // console.log('koboinfo ' + JSON.stringify(data));
                        return (data);
                    });
                    Promise.all([p1]).then(function(values) {
                        $('#spinner').show();
                        map.data.forEach(function(feature) {
                            // If you want, check here for some constraints.
                            // if (feature.getProperty('nameoption') === 'Main Road') {
                            map.data.remove(feature);
                            // }

                        });
                        ifdt = values[0];
                        //console.log(ifdt);
                        if (ifdt.properties.asset_type === 'ERROR') {
                            $('#error').show();
                            $('#error').append("Search not found.<br>Try again.");
                            map.setCenter(new google.maps.LatLng(15.41, -61.32));
                            map.panTo(new google.maps.LatLng(15.41, -61.32));
                            map.setZoom(11);

                        } else {
                            if (ifdt.properties.asset_type === 'ROAD') {
                                $('#response').empty();
                                $('#response').show();
                                $('#response').append("Asset type: " + ifdt.properties.asset_type);

                                jsonObject = ifdt;
                                // console.log(jsonObject);
                                jsonObject.properties.color = "#5b5e63";
                                jsonObject.properties.nameoption = "Main Road";
                                map.data.addGeoJson(jsonObject);
                                map.setCenter(new google.maps.LatLng(ifdt.geometry.coordinates[0][1], ifdt.geometry.coordinates[0][0]));
                                map.panTo(new google.maps.LatLng(ifdt.geometry.coordinates[0][1], ifdt.geometry.coordinates[0][0]));
                                map.setZoom(16);
                            } else if (ifdt.properties.asset_type === 'BRIDGE') {
                                $('#response').empty();
                                $('#response').show();
                                $('#response').append("Asset type: " + ifdt.properties.asset_type);

                                if (ifdt.properties.koboedit[0] != undefined || ifdt.properties.koboedit[0].kobo_id != undefined) {
                                    var dataPhotoPost = {};
                                    var pphoto = $.ajax({
                                        url: '/auth/WEB/koboinfo/list_koboinfos/' + ifdt.properties.koboedit[0].kobo_id,
                                        data: JSON.stringify(dataPhotoPost),
                                        type: 'POST',
                                        contentType: 'application/json'
                                    }, function(data) {
                                        // console.log('koboinfo ' + JSON.stringify(data));
                                        return (data);
                                    });
                                    Promise.all([pphoto]).then(function(values) {
                                        koboinfo = values[0];
                                        $.each(koboinfo, function(key, value) {
                                            if (key === 'properties') {
                                                $.each(value, function(kprop, vprop) {
                                                    //console.log(kprop, vprop);
                                                    if (kprop === "_attachments") {

                                                        $("#datainfophoto").empty();
                                                        $("#datainfophoto").show();
                                                        $.each(vprop, function(kfoto, vfoto) {
                                                            var fotosmall = vfoto.replace(".jpg", "-small.jpg");
                                                            $("#datainfophoto").append('<img src="' + fotosmall + '">');
                                                            // $("#formkobo").append('<input name="kobo[properties][' + kprop + ']" required class="form-control" value="' + vfoto + '" type="hidden">');
                                                        });
                                                    }


                                                });
                                            };
                                        });
                                    });
                                }
                                jsonObject = ifdt;
                                // console.log(jsonObject);
                                jsonObject.properties.color = "#F47983";
                                jsonObject.properties.nameoption = "Bridge";
                                map.data.addGeoJson(jsonObject);
                                map.setCenter(new google.maps.LatLng(ifdt.geometry.coordinates[0][1], ifdt.geometry.coordinates[0][0]));
                                map.panTo(new google.maps.LatLng(ifdt.geometry.coordinates[0][1], ifdt.geometry.coordinates[0][0]));
                                map.setZoom(22);
                            } else if (ifdt.properties.asset_type === 'GEOT') {
                                $('#response').empty();
                                $('#response').show();
                                $('#response').append("Asset type: " + ifdt.properties.asset_type);

                                jsonObject = ifdt;
                                // console.log(jsonObject);
                                jsonObject.properties.color = "green";
                                jsonObject.properties.nameoption = "Geot";
                                map.data.addGeoJson(jsonObject);
                                map.setCenter(new google.maps.LatLng(ifdt.geometry.coordinates[0][1], ifdt.geometry.coordinates[0][0]));
                                map.panTo(new google.maps.LatLng(ifdt.geometry.coordinates[0][1], ifdt.geometry.coordinates[0][0]));
                                map.setZoom(19);
                            } else if (ifdt.properties.asset_type === 'CULVERT') {
                                $('#response').empty();
                                $('#response').show();
                                $('#response').append("Asset type: " + ifdt.properties.asset_type);
                                jsonObject = ifdt;
                                // console.log(jsonObject); 
                                jsonObject.properties.color = "#a17cff";
                                jsonObject.properties.nameoption = "Culvert";
                                map.data.addGeoJson(jsonObject);
                                map.setCenter(new google.maps.LatLng(ifdt.geometry.coordinates[0][1], ifdt.geometry.coordinates[0][0]));
                                map.panTo(new google.maps.LatLng(ifdt.geometry.coordinates[0][1], ifdt.geometry.coordinates[0][0]));
                                map.setZoom(22);
                            } else if (ifdt.properties.asset_type === 'DRAINAGE') {
                                $('#response').empty();
                                $('#response').show();
                                $('#response').append("Asset type: " + ifdt.properties.asset_type);
                                jsonObject = ifdt;
                                // console.log(jsonObject); 
                                jsonObject.properties.color = "#135dd6";
                                jsonObject.properties.nameoption = "Drainage";
                                map.data.addGeoJson(jsonObject);
                                map.setCenter(new google.maps.LatLng(ifdt.geometry.coordinates[0][1], ifdt.geometry.coordinates[0][0]));
                                map.panTo(new google.maps.LatLng(ifdt.geometry.coordinates[0][1], ifdt.geometry.coordinates[0][0]));
                                map.setZoom(22);
                            }
                            ifdtobject = ifdt;
                            console.log(ifdt);
                        }
                        $('#spinner').hide();

                    });
                }
            }
        });


        $('#searchtool').on('input', function() {

            var $this = $(this);

            if (nchar == 0 && !resized) {
                nchar = $this.val().length;
                $("#divmap2").animate({
                    width: '50%'
                }, 1500, function() {
                    resized = true;
                    $('#rowmap').prepend('<div id="divmap1"' +
                        'class="col-md-6" style="height:80vh;" >' +
                        '</div>'
                    );
                    $("#divmap2").toggleClass('col-md-12 col-md-6');
                    if (map) {
                        // console.log(map.getCenter());
                        google.maps.event.trigger(map, 'resize');
                        map.setCenter(new google.maps.LatLng(15.41, -61.32));
                        map.panTo(new google.maps.LatLng(15.41, -61.32));
                        // console.log(map.getCenter());
                    }
                    $('#datainfo').show();

                });
            } else {
                nchar = $this.val().length;

            }
            // console.log(nchar);


        });


    });
</script>