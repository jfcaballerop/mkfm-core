<script>
    $(document).ready(function() {

        $(":radio").prop('disabled', true);
        $("#generateReport").prop('disabled', true);

        $('#openPdf').click(function() {

            pdfMake.createPdf(docDefinition).open();
        });

        $("#searchtool").on('keyup', function(e) {
            var $this = $(this);
            if (e.keyCode == 13) {
                $(":radio").prop('checked', false);

                $('#error').hide();
                $('#error').empty();
                $('#response').hide();
                $('#response').empty();
                var dataPost = {};

                if ($this.val().length <= 0) {
                    $('#error').hide();
                    $('#error').empty();
                    $('#error').append("Empty value.<br>Try again.");
                    $('#error').show();
                    $(":radio").prop('disabled', true);
                    $("#generateReport").prop('disabled', true);

                } else {


                    var p1 = $.ajax({
                        url: '/auth/WEB/infodatatrack/list_ifdt/' + $this.val(),
                        data: JSON.stringify(dataPost),
                        type: 'POST',
                        contentType: 'application/json'
                    }, function(data) {
                        //// console.log('koboinfo ' + JSON.stringify(data));
                        return (data);
                    });
                    Promise.all([p1]).then(function(values) {
                        $('#spinner').show();
                        ifdt = values[0];
                        // console.log(ifdt);
                        if (ifdt.properties.asset_type === 'ERROR') {
                            $('#error').show();
                            $('#error').append("Search not found.<br>Try again.");
                            $(":radio").prop('disabled', true);
                            $("#generateReport").prop('disabled', true);


                        } else {
                            var assetType = '';
                            switch (ifdt.properties.asset_type) {
                                case 'BRIDGE':
                                    assetType = 'BRIDGE';
                                    break;
                                case 'ROAD':
                                    assetType = 'ROAD';
                                    break;
                                case 'CULVERT':
                                    assetType = 'CULVERT';
                                    break
                                case 'DRAINAGE':
                                    assetType = 'DRAINAGE (no report for this asset)';
                                    break
                                case 'FORD':
                                    assetType = 'CULVERT';
                                    break;
                                case 'GEOT':
                                    assetType = 'GEOTECHNICAL';
                                    break;
                                case 'GEOT2':
                                    assetType = 'GEOTECHNICAL';
                                    break;
                                default:
                                    break;
                            }

                            $('#response').empty();
                            $('#response').show();
                            $('#response').append("Asset type: " + assetType);
                            // console.log(ifdt.properties.asset_type);
                            console.log(ifdt.properties.gtype);
                            console.log(ifdt.properties.gtype2);
                            switch (ifdt.properties.asset_type) {
                                case 'BRIDGE':
                                    $(":radio[value*='RIDG']").each(function(index) {
                                        $this = $(this);
                                        $this.prop('disabled', false);
                                    });
                                    $(":radio[value*='EAR']").each(function(index) {
                                        $this = $(this);
                                        $this.prop('disabled', true);
                                    });
                                    $(":radio[value*='LVERT']").each(function(index) {
                                        $this = $(this);
                                        $this.prop('disabled', true);
                                    });
                                    // $(":radio*").each(function(index) {
                                    $(":radio[value*='RETA']").each(function(index) {
                                        $this = $(this);
                                        $this.prop('disabled', true);
                                    });
                                    $(":radio[value*='PAV']").each(function(index) {
                                        $this = $(this);
                                        $this.prop('disabled', true);
                                    });

                                    break;
                                case 'ROAD':
                                    $(":radio[value*='RIDG']").each(function(index) {
                                        $this = $(this);
                                        $this.prop('disabled', true);
                                    });
                                    $(":radio[value*='EAR']").each(function(index) {
                                        $this = $(this);
                                        $this.prop('disabled', true);
                                    });
                                    $(":radio[value*='LVERT']").each(function(index) {
                                        $this = $(this);
                                        $this.prop('disabled', true);
                                    });
                                    // $(":radio*").each(function(index) {
                                    $(":radio[value*='RETA']").each(function(index) {
                                        $this = $(this);
                                        $this.prop('disabled', true);
                                    });
                                    $(":radio[value*='PAV']").each(function(index) {
                                        $this = $(this);
                                        $this.prop('disabled', false);
                                    });

                                    break;
                                case 'CULVERT':
                                    $(":radio[value*='RIDG']").each(function(index) {
                                        $this = $(this);
                                        $this.prop('disabled', true);
                                    });
                                    $(":radio[value*='EAR']").each(function(index) {
                                        $this = $(this);
                                        $this.prop('disabled', true);
                                    });
                                    $(":radio[value*='LVERT']").each(function(index) {
                                        $this = $(this);
                                        $this.prop('disabled', false);
                                    });
                                    // $(":radio*").each(function(index) {
                                    $(":radio[value*='RETA']").each(function(index) {
                                        $this = $(this);
                                        $this.prop('disabled', true);
                                    });
                                    $(":radio[value*='PAV']").each(function(index) {
                                        $this = $(this);
                                        $this.prop('disabled', true);
                                    });
                                    break
                                case 'DRAINAGE':
                                    $(":radio[value*='RIDG']").each(function(index) {
                                        $this = $(this);
                                        $this.prop('disabled', true);
                                    });
                                    $(":radio[value*='EAR']").each(function(index) {
                                        $this = $(this);
                                        $this.prop('disabled', true);
                                    });
                                    $(":radio[value*='LVERT']").each(function(index) {
                                        $this = $(this);
                                        $this.prop('disabled', true);
                                    });
                                    // $(":radio*").each(function(index) {
                                    $(":radio[value*='RETA']").each(function(index) {
                                        $this = $(this);
                                        $this.prop('disabled', true);
                                    });
                                    $(":radio[value*='PAV']").each(function(index) {
                                        $this = $(this);
                                        $this.prop('disabled', true);
                                    });
                                    break
                                case 'FORD': // type of culvert
                                    $(":radio[value*='RIDG']").each(function(index) {
                                        $this = $(this);
                                        $this.prop('disabled', true);
                                    });
                                    $(":radio[value*='EAR']").each(function(index) {
                                        $this = $(this);
                                        $this.prop('disabled', true);
                                    });
                                    $(":radio[value*='LVERT']").each(function(index) {
                                        $this = $(this);
                                        $this.prop('disabled', false);
                                    });
                                    // $(":radio*").each(function(index) {
                                    $(":radio[value*='RETA']").each(function(index) {
                                        $this = $(this);
                                        $this.prop('disabled', true);
                                    });
                                    $(":radio[value*='PAV']").each(function(index) {
                                        $this = $(this);
                                        $this.prop('disabled', true);
                                    });
                                    break;
                                case 'GEOT':
                                    if (ifdt.properties.gtype === 'Cutting' ||
                                        ifdt.properties.gtype2 === 'Cutting' ||
                                        ifdt.properties.gtype === 'Embankment' ||
                                        ifdt.properties.gtype2 === 'Embankment') {
                                        $(":radio[value*='RIDG']").each(function(index) {
                                            $this = $(this);
                                            $this.prop('disabled', true);
                                        });
                                        $(":radio[value*='EAR']").each(function(index) {
                                            $this = $(this);
                                            $this.prop('disabled', false);
                                        });
                                        $(":radio[value*='LVERT']").each(function(index) {
                                            $this = $(this);
                                            $this.prop('disabled', true);
                                        });
                                        // $(":radio*").each(function(index) {
                                        $(":radio[value*='RETA']").each(function(index) {
                                            $this = $(this);
                                            $this.prop('disabled', true);
                                        });
                                        $(":radio[value*='PAV']").each(function(index) {
                                            $this = $(this);
                                            $this.prop('disabled', true);
                                        });
                                    } else {
                                        $(":radio[value*='RIDG']").each(function(index) {
                                            $this = $(this);
                                            $this.prop('disabled', true);
                                        });
                                        $(":radio[value*='EAR']").each(function(index) {
                                            $this = $(this);
                                            $this.prop('disabled', true);
                                        });
                                        $(":radio[value*='LVERT']").each(function(index) {
                                            $this = $(this);
                                            $this.prop('disabled', true);
                                        });
                                        // $(":radio*").each(function(index) {
                                        $(":radio[value*='RETA']").each(function(index) {
                                            $this = $(this);
                                            $this.prop('disabled', false);
                                        });
                                        $(":radio[value*='PAV']").each(function(index) {
                                            $this = $(this);
                                            $this.prop('disabled', true);
                                        });
                                    };
                                    break;
                                case 'GEOT2':
                                    if (ifdt.properties.gtype === 'Cutting' ||
                                        ifdt.properties.gtype2 === 'Cutting' ||
                                        ifdt.properties.gtype === 'Embankment' ||
                                        ifdt.properties.gtype2 === 'Embankment') {
                                        $(":radio[value*='RIDG']").each(function(index) {
                                            $this = $(this);
                                            $this.prop('disabled', true);
                                        });
                                        $(":radio[value*='EAR']").each(function(index) {
                                            $this = $(this);
                                            $this.prop('disabled', false);
                                        });
                                        $(":radio[value*='LVERT']").each(function(index) {
                                            $this = $(this);
                                            $this.prop('disabled', true);
                                        });
                                        // $(":radio*").each(function(index) {
                                        $(":radio[value*='RETA']").each(function(index) {
                                            $this = $(this);
                                            $this.prop('disabled', true);
                                        });
                                        $(":radio[value*='PAV']").each(function(index) {
                                            $this = $(this);
                                            $this.prop('disabled', true);
                                        });
                                    } else {
                                        $(":radio[value*='RIDG']").each(function(index) {
                                            $this = $(this);
                                            $this.prop('disabled', true);
                                        });
                                        $(":radio[value*='EAR']").each(function(index) {
                                            $this = $(this);
                                            $this.prop('disabled', true);
                                        });
                                        $(":radio[value*='LVERT']").each(function(index) {
                                            $this = $(this);
                                            $this.prop('disabled', true);
                                        });
                                        // $(":radio*").each(function(index) {
                                        $(":radio[value*='RETA']").each(function(index) {
                                            $this = $(this);
                                            $this.prop('disabled', false);
                                        });
                                        $(":radio[value*='PAV']").each(function(index) {
                                            $this = $(this);
                                            $this.prop('disabled', true);
                                        });
                                    };
                                    break;

                                default:
                                    break;
                            }

                            $("#generateReport").prop('disabled', true);


                        }

                        $('#spinner').hide();

                    });
                }
            }

        });

        var selected;
        $(":radio").change(function() {
            $this = $(this);
            // console.log($this[0].value);
            selected = $this[0].value;
            $("#generateReport").prop('disabled', false);

        });



        $('#generateReport').click(function() {
            var dataPost = {};

            var p1 = $.ajax({
                url: '/auth/WEB/report/generatePDF/' + selected + '/' + ifdt.properties.asset_type + '/' + $(
                    '#searchtool').val(),
                data: JSON.stringify(dataPost),
                type: 'POST',
                contentType: 'application/json'
            }, function(data) {
                //// console.log('koboinfo ' + JSON.stringify(data));
                return (data);
            });
            Promise.all([p1]).then(function(values) {
                $('#spinner').show();
                ret = values[0];
                // console.log(ret);
                if (ret.result !== 'OK') {
                    $('#error').show();
                    $('#error').append("No report available<br>Try again.");

                } else {
                    $('#response').empty();
                    $('#iframeContainer').empty();
                    $('#response').show();
                    $('#response').append("Generating...");
                    //$(":radio").prop('disabled', false);
                    $("#generateReport").prop('disabled', true);
                    $('#spinner').hide();
                    docDefinition = ret.docDefinition;
                    var pdfDocGenerator = pdfMake.createPdf(docDefinition);
                    pdfDocGenerator.getDataUrl((dataUrl) => {
                        const targetElement = document.querySelector('#iframeContainer');
                        const iframe = document.createElement('iframe');
                        iframe.src = dataUrl;
                        iframe.style.width = "100%";
                        iframe.style.height = ($(window).height() - 200) + 'px';
                        targetElement.appendChild(iframe);
                    });
                    // pdfMake.createPdf(docDefinition).open();

                }

                $('#spinner').hide();

            });

        });
    });
</script>